{"mappings":"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","sources":["src/js/gallery2.js"],"sourcesContent":["import Notiflix from 'notiflix';\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport '../css/common.css';\nimport galleryCardAdditionalTpl from './templates/gallery-additional';\nimport throttle from 'lodash.throttle';\nimport SearchService from './searchService';\nimport LoadMoreBtn from './load-more-btn';\n\nconst searchFormEl = document.querySelector('#search-form');\nconst cardContainerEl = document.querySelector('.gallery');\n\n\nconst submitBtn = new LoadMoreBtn({ selector: '.submit-btn', hidden: false })\nconst searchService = new SearchService();\n\nlet lastScroll = 0;\n\nsearchFormEl.addEventListener('submit', onSearch);\nwindow.addEventListener('scroll', throttle(onLoadMore, 500));\n\nasync function onSearch(e) {\n    e.preventDefault();\n    clearCardcontainer();\n\n    searchService.word = e.currentTarget.elements.searchQuery.value.trim();\n    \n    if (isSearchQueryAmpty(searchService.word)) {\n        return;\n    }; \n\n    searchService.resetPage();\n    searchService.resetViewedPhotoes();\n    submitBtn.disabled();\n\n    try {\n        const { hits, totalHits } = await searchService.fetchArticles();\n\n        if (isArrayOfDataAmpty(hits.length)) {\n            return;\n        }\n\n        totalFoundPicturesMessage(totalHits);\n        appendPhotoCardMarkup(hits);\n        submitBtn.enable();      \n        \n    } catch (error) {\n        onSomeError(error);\n    };  \n}\n\nasync function onLoadMore() {\n\n    if (searchService.viewedPhotoes < searchService.perPage && window.pageYOffset + document.documentElement.clientHeight >= getDocHeight() - 10) {\n        endOfResultsMessage();\n\n        return;\n    }\n    \n    if (searchService.viewedPhotoes < searchService.perPage) {\n        return;\n    }\n    \n    if (window.pageYOffset + document.documentElement.clientHeight >= getDocHeight() - 20) {   \n        try {\n            const { hits, totalHits } = await searchService.fetchArticles();\n\n            appendPhotoCardMarkup(hits);\n            smoothScroll('gallery');\n\n            if (totalHits <= searchService.viewedPhotoes) {\n                onScroll();\n                window.removeEventListener('scroll', onLoadMore);\n\n                return;\n            }  \n            \n        } catch (error) {\n            onSomeError(error);\n        };\n    }\n}\n\nfunction endOfResultsMessage() {\n    Notiflix.Notify.info(\"We're sorry, but you've reached the end of search results.\");\n}\n\nfunction totalFoundPicturesMessage(totalHits) {\n    Notiflix.Notify.success(`Hooray! We found ${totalHits} images.`);\n}\n\nfunction appendPhotoCardMarkup(hits) {\n    const makePhotoCards = hits\n        .map(galleryCardAdditionalTpl)\n        .join('');\n    \n    cardContainerEl.insertAdjacentHTML('beforeend', makePhotoCards);\n\n    let gallery = new SimpleLightbox('.gallery a');\n    gallery.refresh();\n}\n\nfunction smoothScroll(className) {\n    const { height: cardHeight } = document.querySelector(`.${className}`).firstElementChild.getBoundingClientRect();\n\n    window.scrollBy({\n        top: cardHeight * 2,\n        behavior: \"smooth\",\n    });\n}\n\nfunction onScroll() {\n    if (scrollPosition() > lastScroll) {   \n        endOfResultsMessage();\n    };\n    \n    lastScroll = scrollPosition(); \n}\n\nfunction scrollPosition() {\n    return window.pageYOffset || document.documentElement.scroll;\n}\n\nfunction isSearchQueryAmpty(searchQuery) {\n    if (searchQuery === '') {\n        Notiflix.Notify.warning(\"Please, enter a search query!\");\n\n        return true;\n    };\n}\n\nfunction isArrayOfDataAmpty(length) {\n    if (length === 0) {\n        submitBtn.enable();\n        Notiflix.Notify.failure(\"Sorry, there are no images matching your search query. Please try again.\");\n        \n        return true;\n    };\n}\n\nfunction onSomeError(error) {\n    Notiflix.Notify.info(\"We're sorry, try ones more.\");\n    submitBtn.enable();\n    console.log(error);\n}\n\nfunction clearCardcontainer() {\n    cardContainerEl.innerHTML = '';\n}\n\nfunction getDocHeight() {\n    return Math.max(\n        document.body.scrollHeight, document.documentElement.scrollHeight,\n        document.body.offsetHeight, document.documentElement.offsetHeight,\n        document.body.clientHeight, document.documentElement.clientHeight\n    );\n}\n\n"],"names":["$bpxeT","parcelRequire","$bb1d5d0fa0454270$var$searchFormEl","document","querySelector","$bb1d5d0fa0454270$var$cardContainerEl","$bb1d5d0fa0454270$var$submitBtn","$gGuPt","default","selector","hidden","$bb1d5d0fa0454270$var$searchService","$h3pWP","$bb1d5d0fa0454270$var$lastScroll","$bb1d5d0fa0454270$var$_onSearch","$parcel$interopDefault","$2TvXO","mark","_callee","e","ref","hits","totalHits","preventDefault","$bb1d5d0fa0454270$var$clearCardcontainer","word","currentTarget","elements","searchQuery","value","trim","$bb1d5d0fa0454270$var$isSearchQueryAmpty","resetPage","resetViewedPhotoes","disabled","fetchArticles","_ctx","sent","$bb1d5d0fa0454270$var$isArrayOfDataAmpty","length","$bb1d5d0fa0454270$var$totalFoundPicturesMessage","$bb1d5d0fa0454270$var$appendPhotoCardMarkup","enable","$bb1d5d0fa0454270$var$onSomeError","t0","apply","this","arguments","$bb1d5d0fa0454270$var$onLoadMore","$bb1d5d0fa0454270$var$_onLoadMore","viewedPhotoes","perPage","window","pageYOffset","documentElement","clientHeight","$bb1d5d0fa0454270$var$getDocHeight","$bb1d5d0fa0454270$var$endOfResultsMessage","$bb1d5d0fa0454270$var$smoothScroll","$bb1d5d0fa0454270$var$onScroll","removeEventListener","$6JpON","Notify","info","success","concat","makePhotoCards","map","$ag7wj","join","insertAdjacentHTML","$5IjG7","refresh","className","cardHeight","firstElementChild","getBoundingClientRect","height","scrollBy","top","behavior","$bb1d5d0fa0454270$var$scrollPosition","scroll","warning","failure","error","console","log","innerHTML","Math","max","body","scrollHeight","offsetHeight","addEventListener","$dCfNN"],"version":3,"file":"gallery2.b81bf84a.js.map"}