{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,S,iEASA,MAAMC,EAAeC,SAASC,cAAc,gBACtCC,EAAkBF,SAASC,cAAc,YAGzCE,EAAY,IAAI,EAAAC,EAAAC,SAAY,CAAEC,SAAU,cAAeC,QAAQ,IAC/DC,EAAgB,IAAI,EAAAC,EAAAJ,SAE1B,IAAIK,EAAa,EAmEjB,SAASC,IACLC,EAAAf,GAASgB,OAAOC,KAAK,6D,CAOzB,SAASC,EAAsBC,GAC3B,MAAMC,EAAiBD,EAClBE,IAAIC,EAAAd,SACJe,KAAK,IAEVlB,EAAgBmB,mBAAmB,YAAaJ,GAElC,IAAIL,EAAAU,GAAJ,CAAmB,cACzBC,S,CAoBZ,SAASC,IACL,OAAOC,OAAOC,aAAe1B,SAAS2B,gBAAgBC,M,CAoB1D,SAASC,EAAYC,GACjBlB,EAAAf,GAASgB,OAAOC,KAAK,+BACrBX,EAAU4B,SACVC,QAAQC,IAAIH,E,CAOhB,SAASI,IACL,OAAOC,KAAKC,IACRpC,SAASqC,KAAKC,aAActC,SAAS2B,gBAAgBW,aACrDtC,SAASqC,KAAKE,aAAcvC,SAAS2B,gBAAgBY,aACrDvC,SAASqC,KAAKG,aAAcxC,SAAS2B,gBAAgBa,a,CAxI7DzC,EAAa0C,iBAAiB,UAG9BC,eAAwBC,GAMpB,GALAA,EAAEC,iBA4HN,WACI1C,EAAgB2C,UAAY,E,CA5H5BC,GAEAtC,EAAcuC,KAAOJ,EAAEK,cAAcC,SAASC,YAAYC,MAAMC,OAkGpE,SAA4BF,GACxB,GAAoB,KAAhBA,EAGA,OAFAtC,EAAAf,GAASgB,OAAOwC,QAAQ,kCAEjB,C,CApGPC,CAAmB9C,EAAcuC,MACjC,OAGJvC,EAAc+C,YACd/C,EAAcgD,qBACdrD,EAAUsD,WAEV,IACI,MAAMzC,KAAEA,EAAI0C,UAAEA,SAAoBlD,EAAcmD,gBAEhD,GA6FR,SAA4BC,GACxB,GAAe,IAAXA,EAIA,OAHAzD,EAAU4B,SACVnB,EAAAf,GAASgB,OAAOgD,QAAQ,6EAEjB,C,CAlGHC,CAAmB9C,EAAK4C,QACxB,QAgDZ,SAAmCF,GAC/B9C,EAAAf,GAASgB,OAAOkD,QAAQ,oBAAoBL,Y,CA9CxCM,CAA0BN,GAC1B3C,EAAsBC,GACtBb,EAAU4B,Q,CAEZ,MAAOD,GACLD,EAAYC,E,KA5BpBL,OAAOgB,iBAAiB,SAAU7B,EAAAqD,EAAA,EAgClCvB,eAAewB,IAEX,GAAI1D,EAAc2D,cAAgB3D,EAAc4D,SAAW3C,OAAOC,YAAc1B,SAAS2B,gBAAgBa,cAAgBN,IAAiB,GAGtI,YAFAvB,IAKJ,GAAIH,EAAc2D,cAAgB3D,EAAc4D,QAC5C,OAGJ,GAAI3C,OAAOC,YAAc1B,SAAS2B,gBAAgBa,cAAgBN,IAAiB,GAC/E,IACI,MAAMlB,KAAEA,EAAI0C,UAAEA,SAAoBlD,EAAcmD,gBAKhD,GAHA5C,EAAsBC,GAmClC,SAAsBqD,GAClB,MAAQC,OAAQC,GAAevE,SAASC,cAAc,IAAIoE,KAAaG,kBAAkBC,wBAEzFhD,OAAOiD,SAAS,CACZC,IAAkB,EAAbJ,EACLK,SAAU,U,CAvCNC,CAAa,WAETnB,GAAalD,EAAc2D,cAI3B,OAqChB,WACQ3C,IAAmBd,GACnBC,IAGJD,EAAac,G,CA7CDsD,QACArD,OAAOsD,oBAAoB,SAAUb,E,CAK3C,MAAOpC,GACLD,EAAYC,E,IA3D+B","sources":["src/js/gallery2.js"],"sourcesContent":["import Notiflix from 'notiflix';\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport '../css/common.css';\nimport galleryCardAdditionalTpl from './templates/gallery-additional';\nimport throttle from 'lodash.throttle';\nimport SearchService from './searchService';\nimport LoadMoreBtn from './load-more-btn';\n\nconst searchFormEl = document.querySelector('#search-form');\nconst cardContainerEl = document.querySelector('.gallery');\n\n\nconst submitBtn = new LoadMoreBtn({ selector: '.submit-btn', hidden: false })\nconst searchService = new SearchService();\n\nlet lastScroll = 0;\n\nsearchFormEl.addEventListener('submit', onSearch);\nwindow.addEventListener('scroll', throttle(onLoadMore, 500));\n\nasync function onSearch(e) {\n    e.preventDefault();\n    clearCardcontainer();\n\n    searchService.word = e.currentTarget.elements.searchQuery.value.trim();\n    \n    if (isSearchQueryAmpty(searchService.word)) {\n        return;\n    }; \n\n    searchService.resetPage();\n    searchService.resetViewedPhotoes();\n    submitBtn.disabled();\n\n    try {\n        const { hits, totalHits } = await searchService.fetchArticles();\n\n        if (isArrayOfDataAmpty(hits.length)) {\n            return;\n        }\n\n        totalFoundPicturesMessage(totalHits);\n        appendPhotoCardMarkup(hits);\n        submitBtn.enable();      \n        \n    } catch (error) {\n        onSomeError(error);\n    };  \n}\n\nasync function onLoadMore() {\n\n    if (searchService.viewedPhotoes < searchService.perPage && window.pageYOffset + document.documentElement.clientHeight >= getDocHeight() - 10) {\n        endOfResultsMessage();\n\n        return;\n    }\n    \n    if (searchService.viewedPhotoes < searchService.perPage) {\n        return;\n    }\n    \n    if (window.pageYOffset + document.documentElement.clientHeight >= getDocHeight() - 20) {   \n        try {\n            const { hits, totalHits } = await searchService.fetchArticles();\n\n            appendPhotoCardMarkup(hits);\n            smoothScroll('gallery');\n\n            if (totalHits <= searchService.viewedPhotoes) {\n                onScroll();\n                window.removeEventListener('scroll', onLoadMore);\n\n                return;\n            }  \n            \n        } catch (error) {\n            onSomeError(error);\n        };\n    }\n}\n\nfunction endOfResultsMessage() {\n    Notiflix.Notify.info(\"We're sorry, but you've reached the end of search results.\");\n}\n\nfunction totalFoundPicturesMessage(totalHits) {\n    Notiflix.Notify.success(`Hooray! We found ${totalHits} images.`);\n}\n\nfunction appendPhotoCardMarkup(hits) {\n    const makePhotoCards = hits\n        .map(galleryCardAdditionalTpl)\n        .join('');\n    \n    cardContainerEl.insertAdjacentHTML('beforeend', makePhotoCards);\n\n    let gallery = new SimpleLightbox('.gallery a');\n    gallery.refresh();\n}\n\nfunction smoothScroll(className) {\n    const { height: cardHeight } = document.querySelector(`.${className}`).firstElementChild.getBoundingClientRect();\n\n    window.scrollBy({\n        top: cardHeight * 2,\n        behavior: \"smooth\",\n    });\n}\n\nfunction onScroll() {\n    if (scrollPosition() > lastScroll) {   \n        endOfResultsMessage();\n    };\n    \n    lastScroll = scrollPosition(); \n}\n\nfunction scrollPosition() {\n    return window.pageYOffset || document.documentElement.scroll;\n}\n\nfunction isSearchQueryAmpty(searchQuery) {\n    if (searchQuery === '') {\n        Notiflix.Notify.warning(\"Please, enter a search query!\");\n\n        return true;\n    };\n}\n\nfunction isArrayOfDataAmpty(length) {\n    if (length === 0) {\n        submitBtn.enable();\n        Notiflix.Notify.failure(\"Sorry, there are no images matching your search query. Please try again.\");\n        \n        return true;\n    };\n}\n\nfunction onSomeError(error) {\n    Notiflix.Notify.info(\"We're sorry, try ones more.\");\n    submitBtn.enable();\n    console.log(error);\n}\n\nfunction clearCardcontainer() {\n    cardContainerEl.innerHTML = '';\n}\n\nfunction getDocHeight() {\n    return Math.max(\n        document.body.scrollHeight, document.documentElement.scrollHeight,\n        document.body.offsetHeight, document.documentElement.offsetHeight,\n        document.body.clientHeight, document.documentElement.clientHeight\n    );\n}\n\n"],"names":["$7Y9D8","parcelRequire","$5b6cb498bd77ff28$var$searchFormEl","document","querySelector","$5b6cb498bd77ff28$var$cardContainerEl","$5b6cb498bd77ff28$var$submitBtn","$2cvPU","default","selector","hidden","$5b6cb498bd77ff28$var$searchService","$aYq7L","$5b6cb498bd77ff28$var$lastScroll","$5b6cb498bd77ff28$var$endOfResultsMessage","$parcel$interopDefault","Notify","info","$5b6cb498bd77ff28$var$appendPhotoCardMarkup","hits","makePhotoCards","map","$hDK3b","join","insertAdjacentHTML","$fZKcF","refresh","$5b6cb498bd77ff28$var$scrollPosition","window","pageYOffset","documentElement","scroll","$5b6cb498bd77ff28$var$onSomeError","error","enable","console","log","$5b6cb498bd77ff28$var$getDocHeight","Math","max","body","scrollHeight","offsetHeight","clientHeight","addEventListener","async","e","preventDefault","innerHTML","$5b6cb498bd77ff28$var$clearCardcontainer","word","currentTarget","elements","searchQuery","value","trim","warning","$5b6cb498bd77ff28$var$isSearchQueryAmpty","resetPage","resetViewedPhotoes","disabled","totalHits","fetchArticles","length","failure","$5b6cb498bd77ff28$var$isArrayOfDataAmpty","success","$5b6cb498bd77ff28$var$totalFoundPicturesMessage","$9OeKo","$5b6cb498bd77ff28$var$onLoadMore","viewedPhotoes","perPage","className","height","cardHeight","firstElementChild","getBoundingClientRect","scrollBy","top","behavior","$5b6cb498bd77ff28$var$smoothScroll","$5b6cb498bd77ff28$var$onScroll","removeEventListener"],"version":3,"file":"gallery2.844e8abd.js.map"}